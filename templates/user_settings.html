{% extends "base.html" %}

{% block title %}Settings - Personal OS{% endblock %}

{% block nav %}
<li class="nav-item"><a class="nav-link" href="/boards">Boards</a></li>
<li class="nav-item"><a class="nav-link" href="/inbox">Inbox</a></li>
<li class="nav-item"><a class="nav-link active" href="/settings">Settings</a></li>
{% endblock %}

{% block nav_right %}
<li class="nav-item"><a class="nav-link" href="/settings"><i class="bi bi-gear"></i></a></li>
<li class="nav-item">
    <form method="post" action="/logout" class="d-inline">
        <button type="submit" class="nav-link btn btn-link">Logout ({{ user }})</button>
    </form>
</li>
{% endblock %}

{% block content %}
<h1 class="mb-4">User Settings</h1>

<div class="row">
    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">LLM Context</h5>
            </div>
            <div class="card-body">
                <p class="text-muted">Provide additional context about yourself that will be included in all AI assistant conversations. This helps the assistant understand your preferences, role, or any specific instructions.</p>
                <form method="post" action="/settings/llm-context">
                    <div class="mb-3">
                        <label for="llmContext" class="form-label">Custom Context</label>
                        <textarea class="form-control" id="llmContext" name="llm_context" rows="6" placeholder="Example: I am a software engineer working on web applications. I prefer concise responses and practical examples.">{% if let Some(ctx) = llm_context.as_ref() %}{{ ctx }}{% endif %}</textarea>
                        <div class="form-text">This context is prepended to the system prompt when using the chat assistant.</div>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Context</button>
                </form>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Chat History</h5>
            </div>
            <div class="card-body">
                <p>You have <strong>{{ chat_message_count }}</strong> chat message(s) stored.</p>
                <p class="text-muted">Chat history is used to maintain conversation context with the AI assistant on each board.</p>
                {% if chat_message_count > 0 %}
                <form method="post" action="/settings/chat-history/delete" onsubmit="return confirm('Are you sure you want to delete all your chat history? This cannot be undone.');">
                    <button type="submit" class="btn btn-danger">Delete All Chat History</button>
                </form>
                {% else %}
                <button type="button" class="btn btn-secondary" disabled>No Chat History</button>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="mt-4">
    <a href="/boards" class="btn btn-outline-secondary">Back to Boards</a>
</div>
{% endblock %}
